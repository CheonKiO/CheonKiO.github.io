import{_ as A,c as p,o as y,a as m,F as N,r as $,t as _,n as S,b as B,d as P,e as D,f as Z,w as z,u as K,g as w,h as Q,i as X,j as ee,k as ne,l as C,m as te,p as G,q as oe,s as le,v as se}from"./index-msvG_AaJ.js";import{a as U}from"./index-DxVLoZJQ.js";const ae={class:"board-wrapper"},ie={class:"line-num left"},re=["onClick"],ue={key:0,class:"move-number"},ce={class:"line-num bottom"},de={__name:"GameBoard",props:{flatBoard:Array,lastIndex:Number,onCellClick:Function,isGameOver:Boolean,isBlackTurn:Boolean,isMyTurn:Boolean},setup(i){return(b,l)=>(y(),p("div",ae,[l[0]||(l[0]=m("div",{class:"empty"},null,-1)),l[1]||(l[1]=m("div",{class:"empty"},null,-1)),l[2]||(l[2]=m("div",{class:"empty"},null,-1)),m("div",ie,[(y(),p(N,null,$(15,n=>m("div",{key:"left"+n},_(16-n),1)),64))]),m("div",{class:S(["board",{"game-over":i.isGameOver,"my-turn":i.isMyTurn,turnB:i.isBlackTurn,turnW:!i.isBlackTurn}])},[(y(!0),p(N,null,$(i.flatBoard,(n,r)=>(y(),p("div",{key:r,class:S(["cell",{"has-stone":n!==null,"last-stone":i.lastIndex!==void 0&&r===i.lastIndex}]),onClick:()=>{var o;return(o=i.onCellClick)==null?void 0:o.call(i,r)}},[n!==null?(y(),p("div",{key:0,class:S(["stone",n%2===1?"black":"white"])},[i.isGameOver?(y(),p("span",ue,_(n),1)):B("",!0)],2)):B("",!0)],10,re))),128))],2),l[3]||(l[3]=m("div",{class:"empty"},null,-1)),l[4]||(l[4]=m("div",{class:"empty"},null,-1)),m("div",ce,[(y(),p(N,null,$(15,n=>m("div",{key:"bottom"+n},_(String.fromCharCode(64+n)),1)),64))]),l[5]||(l[5]=m("div",{class:"empty"},null,-1))]))}},fe=A(de,[["__scopeId","data-v-bd804c11"]]),me={class:"info"},ve={key:0,class:"name"},ye={key:1,calss:"name"},pe={__name:"UserInfo",props:{name:String,isBlack:Boolean,record:String,isActive:Boolean},setup(i){return(b,l)=>{var n;return y(),p("div",{class:S(["user-info stone",{active:i.isActive,black:i.isBlack,white:!i.isBlack}])},[m("div",me,[(n=i.name)!=null&&n.trim()?(y(),p("p",ve,"ÎãâÎÑ§ÏûÑ : "+_(i.name),1)):(y(),p("p",ye,"ÏÉÅÎåÄÍ∞Ä ÏóÜÏäµÎãàÎã§"))])],2)}}},F=A(pe,[["__scopeId","data-v-83f3d876"]]),g=15,E=[[1,0],[0,1],[1,1],[1,-1]],M=i=>[i%g,Math.floor(i/g)];function he(i){return i==null?null:i%2===1?"black":"white"}function be(i,b){const[l,n]=M(b),r={hasOverline:!1,hasFive:!1};for(const[o,s]of E){let e=1;for(const t of[-1,1]){let u=l+o*t,c=n+s*t;for(;u>=0&&u<g&&c>=0&&c<g&&he(i[c*g+u])==="black";)e++,u+=o*t,c+=s*t}e>=6?r.hasOverline=!0:e==5&&(r.hasFive=!0)}return r}function ke(i,b){let l=0;const[n,r]=M(b),o=(s,e)=>s<0||s>=g||e<0||e>=g?"OUT":i[e*g+s];for(const[s,e]of E){for(const t of[-1,1]){let u=o(n+t*s,r+t*e),c=o(n+2*t*s,r+2*t*e),f=o(n+3*t*s,r+3*t*e),v=o(n+4*t*s,r+4*t*e);(u%2===1&&c%2===1&&f%2===1||u%2===1&&c===null&&f%2===1&&v%2===1||u%2===1&&c%2===1&&f===null&&v%2===1||u===null&&c%2===1&&f%2===1&&v%2===1)&&l++}for(const t of[-1,1]){let u=o(n-t*s,r-t*e),c=o(n+t*s,r+t*e),f=o(n+2*t*s,r+2*t*e),v=o(n+3*t*s,r+3*t*e);(u%2===1&&c%2===1&&f%2===1||u%2===1&&c===null&&f%2===1&&v%2===1||u%2===1&&c%2===1&&f===null&&v%2===1)&&l++}for(const t of[-1,1]){let u=o(n-2*t*s,r-2*t*e),c=o(n-t*s,r-t*e),f=o(n+t*s,r+t*e),v=o(n+2*t*s,r+2*t*e);u%2===1&&c%2===1&&f===null&&v%2===1&&l++}}return l}function ge(i,b){const[l,n]=M(b);let r=0;const o=(s,e)=>s<0||s>=g||e<0||e>=g?"OUT":i[e*g+s];for(const[s,e]of E){let t=o(l-2*s,n-2*e),u=o(l-s,n-e),c=o(l+s,n+e),f=o(l+2*s,n+2*e),v;t===null&&u%2===1&&c%2===1&&f==null&&r++;for(const d of[-1,1])t=o(l-d*s,n-d*e),u=o(l+d*s,n+d*e),c=o(l+2*d*s,n+2*d*e),f=o(l+3*d*s,n+3*d*e),t===null&&f===null&&u%2===1&&c%2===1&&r++;for(const d of[-1,1])t=o(l-d*s,n-d*e),u=o(l+d*s,n+d*e),c=o(l+2*d*s,n+2*d*e),f=o(l+3*d*s,n+3*d*e),v=o(l+4*d*s,n+4*d*e),t===null&&v===null&&(u%2===1&&c===null&&f%2===1&&r++,u===null&&c%2===1&&f%2===1&&r++);for(const d of[-1,1])t=o(l-2*d*s,n-2*d*e),u=o(l-d*s,n-d*e),c=o(l+d*s,n+d*e),f=o(l+2*d*s,n+2*d*e),v=o(l+3*d*s,n+3*d*e),t===null&&v===null&&u%2===1&&c===null&&f%2===1&&r++}return r}function _e(i,b){const{hasOverline:l,hasFive:n}=be(i,b),r=ge(i,b),o=ke(i,b);return console.log(r),(l||r>=2||o>=2)&&!n}const Ie={class:"timer"},Be={__name:"TimerComp",props:{initialTime:Number},emits:["timeout"],setup(i,{expose:b,emit:l}){const n=i,r=l,o=P(n.initialTime);let s=null;function e(){s=setInterval(()=>{o.value>0&&(o.value--,o.value===0&&(r("timeout"),t()))},1e3)}function t(){clearInterval(s),s=null}function u(){t()}function c(){!s&&o.value>0&&e()}return D(e),Z(t),z(()=>n.initialTime,()=>{e()}),b({pause:u,resume:c}),(f,v)=>(y(),p("div",Ie,[m("p",null,"Ï∞©Ïàò Ï†úÌïú: "+_(o.value)+"Ï¥à",1)]))}},Te=A(Be,[["__scopeId","data-v-41a649f6"]]),Ce={class:"game-header"},xe={class:"header-left flex col-center"},Pe={key:1},Ne={class:"header-mid flex dir-col row-center col-center"},Se={key:1,class:"victory"},Ae={key:2,class:"turn"},Oe={class:"header-right flex row-end col-center"},$e={class:"game-board"},we={class:"flex dir-col center"},Ee={class:"margin-center"},Me={class:"board-con flex row-center col-center"},Re={class:"flex dir-col row-end"},Ge=["disabled"],x=15,Ue={__name:"BoardPage",setup(i){const b=se(),l=K(),n=w({id:l.playerId,name:l.username,ready:!1}),r=Q(),{show:o}=le(),s=P(null),e=w({title:"",roomId:"",turn:1,board:Array(x*x).fill(null),isPlaying:!1}),t=w({id:null,name:null,ready:!1}),u=P(null),c=P([]),f=P(null),v=X(()=>{const a=e.turn%2===1;return f.value===a});function d(a){var h;!e.isPlaying||!v.value||(e.turn%2==1&&_e(e.board,a),(h=I.stompClient)==null||h.publish({destination:"/app/move",body:JSON.stringify({type:"ACTION",sender:n,roomId:e.roomId??T.params.roomNo,index:a})}))}function J(){var a;(a=I.stompClient)==null||a.publish({destination:"/app/ready",body:JSON.stringify({type:"SURRENDER",sender:n,roomId:e.roomId??T.params.roomNo})})}function V(){var a;(a=I.stompClient)==null||a.publish({destination:"/app/ready",body:JSON.stringify({type:"READY",sender:n,roomId:e.roomId??T.params.roomNo})})}function L(){var a;!e.isPlaying||!v.value||(a=I.stompClient)==null||a.publish({destination:"/app/timeout",body:JSON.stringify({type:"TIMEOUT",sender:n,roomId:e.roomId??T.params.roomNo})})}function H(){var h,k,R;if(e.turn<=1||c.value.length===0){o("Îçî Ïù¥ÏÉÅ Î¨¥Î•º Ïàò ÏóÜÏäµÎãàÎã§.","error");return}(h=s.value)==null||h.pause(),confirm("Ìïú Ïàò Î¨¥Î•¥Í∏∞Ïóê ÎèôÏùòÌïòÏãúÍ≤†ÏäµÎãàÍπå?")?(console.log("ÏöîÏ≤≠ Ï†ÑÏÜ°"),(k=s.value)==null||k.resume(),j()):(console.log("Ï∑®ÏÜåÎê®"),(R=s.value)==null||R.resume())}function j(){const a=c.value.pop();e.board[a]=null,e.turn--,u.value=c.value.length>0?c.value[c.value.length-1]:null,o("Ìïú ÏàòÎ•º Î¨¥Î•¥ÏÖ®ÏäµÎãàÎã§.","info")}const T=ee(),O=T.params.roomNo;console.log("room id = ",O);const I=ne();async function q(){try{await U.post(`${r.BASEURL}/api/rooms/leave/${T.params.roomNo}`,null,{params:{playerId:n.id}}),I.disconnect()}catch(a){console.error("Î∞© ÎÇòÍ∞ÄÍ∏∞ Ïò§Î•ò Î∞úÏÉù:",a)}finally{b.push({name:"Home"})}}async function W(){const{data:a}=await U.get(`${r.BASEURL}/api/rooms/${O}`);console.log(a),e.title=a.title,e.roomId=a.roomId,e.turn=a.turn,e.board.splice(0,e.board.length,...a.board.flat().map(k=>k===0?null:k)),e.isPlaying=a.isPlaying;const h=a.players.find(k=>k.id!==n.id);h!=null&&(t.id=h.id,t.name=h.name)}W();function Y(a){if(a.type==="JOIN"){if(console.log("join"),a.message===n.name)return;console.log(`üì¢ Ïú†Ï†Ä ÏûÖÏû• ÏïåÎ¶º: ${a.message}`),t.name=a.message,t.id=a.sender,o(`${a.message}ÎãòÏù¥ ÏûÖÏû•ÌïòÏÖ®ÏäµÎãàÎã§`)}else if(a.type==="GAME_START")console.log("üéÆ Í≤åÏûÑ ÏãúÏûë Î©îÏãúÏßÄ ÏàòÏã†Îê®!"),e.isPlaying=!0,e.turn=1,e.board=Array(x*x).fill(null),n.ready=!1,t.ready=!1,u.value=null,c.value=[],f.value=a.blackPlayer===n.id,console.log("my stone is black:",f.value),o("Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.","info",2e3);else if(a.type==="ACTION")e.board[a.index]=e.turn,e.turn=a.turn,u.value=a.index,c.value.push(u.value);else if(a.type==="GAME_END")e.board[a.index]=e.turn,e.turn=a.turn,a.index!=null&&(u.value=a.index),c.value.push(u.value),e.isPlaying=!1,o(a.message,"info");else if(a.type==="LEAVE")e.board=Array(x*x).fill(null),o(`${t.name} ÎãòÏù¥ Î∞©ÏùÑ ÎÇòÍ∞îÏäµÎãàÎã§`),t.id=null,t.name=null,t.ready=!1,n.ready=!1;else if(a.type==="READY"){if(a.message===n.name){n.ready=!0;return}t.ready=!0,o(a.message+"Îãò Ï§ÄÎπÑ ÏôÑÎ£å")}}return D(()=>{I.setHandler(Y),I.connect(O,n)}),(a,h)=>{const k=te("font-awesome-icon");return y(),p(N,null,[m("div",Ce,[m("div",xe,[e.isPlaying?(y(),p("button",{key:0,class:"btn rollback-btn",onClick:H},[C(k,{icon:["fas","hands-praying"]}),h[0]||(h[0]=m("div",null,"ÌïúÏàò Î¨¥Î•¥Í∏∞",-1))])):(y(),p("div",Pe,[m("button",{class:"btn out-btn",onClick:q},[C(k,{icon:["fas","arrow-left"]}),h[1]||(h[1]=G("ÎÇòÍ∞ÄÍ∏∞ "))])]))]),m("div",Ne,[e.isPlaying?(y(),oe(Te,{initialTime:10,key:e.turn,onTimeout:L})):B("",!0),e.isPlaying?B("",!0):(y(),p("div",Se,_(e.board[u.value]%2==1?"ÌùëÎèå":"Î∞±Îèå")+" ÏäπÎ¶¨ ",1)),e.isPlaying?(y(),p("div",Ae,"Ï†ú "+_(e.turn)+" Ïàò",1)):B("",!0)]),m("div",Oe,[e.isPlaying?(y(),p("button",{key:0,class:"btn",onClick:J},[C(k,{icon:["far","flag"]}),h[2]||(h[2]=G(" Í∏∞Í∂å "))])):B("",!0)])]),m("div",$e,[m("div",we,[C(F,{class:"opponent",name:t.name,isBlack:!f.value,isActive:!v.value&&e.isPlaying||t.ready&&!e.isPlaying},null,8,["name","isBlack","isActive"]),m("div",Ee,_(t.ready?"Ï§ÄÎπÑ ÏôÑÎ£å":""),1)]),m("div",Me,[C(fe,{isBlackTurn:e.turn%2==1,isMyTurn:v.value,flatBoard:e.board,lastIndex:e.isPlaying?u.value:null,onCellClick:d,isGameOver:!e.isPlaying},null,8,["isBlackTurn","isMyTurn","flatBoard","lastIndex","isGameOver"])]),m("div",Re,[!e.isPlaying&&t.id!=null?(y(),p("button",{key:0,class:"btn",onClick:V,disabled:n.ready}," Ï§ÄÎπÑ ",8,Ge)):B("",!0),C(F,{class:"me",name:n.name,isBlack:f.value,isActive:v.value&&e.isPlaying||n.ready&&!e.isPlaying},null,8,["name","isBlack","isActive"])])])],64)}}},Je=A(Ue,[["__scopeId","data-v-ffdb037a"]]);export{Je as default};
