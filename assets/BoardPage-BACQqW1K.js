import{_ as N,c as p,o as y,a as m,F as A,r as S,t as _,n as $,b as B,d as x,e as R,f as L,w as H,u as j,g as w,h as W,i as Y,j as Z,k as q,l as P,m as z,p as K,q as Q,s as X,v as ee}from"./index-Bjhvo8sS.js";import{a as G}from"./index-DxVLoZJQ.js";const ne={class:"board-wrapper"},te={class:"line-num left"},oe=["onClick"],le={key:0,class:"move-number"},se={class:"line-num bottom"},ae={__name:"GameBoard",props:{flatBoard:Array,lastIndex:Number,onCellClick:Function,isGameOver:Boolean,isBlackTurn:Boolean,isMyTurn:Boolean},setup(i){return(h,l)=>(y(),p("div",ne,[l[0]||(l[0]=m("div",{class:"empty"},null,-1)),l[1]||(l[1]=m("div",{class:"empty"},null,-1)),l[2]||(l[2]=m("div",{class:"empty"},null,-1)),m("div",te,[(y(),p(A,null,S(15,n=>m("div",{key:"left"+n},_(16-n),1)),64))]),m("div",{class:$(["board",{"game-over":i.isGameOver,"my-turn":i.isMyTurn,turnB:i.isBlackTurn,turnW:!i.isBlackTurn}])},[(y(!0),p(A,null,S(i.flatBoard,(n,r)=>(y(),p("div",{key:r,class:$(["cell",{"has-stone":n!==null,"last-stone":i.lastIndex!==void 0&&r===i.lastIndex}]),onClick:()=>{var o;return(o=i.onCellClick)==null?void 0:o.call(i,r)}},[n!==null?(y(),p("div",{key:0,class:$(["stone",n%2===1?"black":"white"])},[i.isGameOver?(y(),p("span",le,_(n),1)):B("",!0)],2)):B("",!0)],10,oe))),128))],2),l[3]||(l[3]=m("div",{class:"empty"},null,-1)),l[4]||(l[4]=m("div",{class:"empty"},null,-1)),m("div",se,[(y(),p(A,null,S(15,n=>m("div",{key:"bottom"+n},_(String.fromCharCode(64+n)),1)),64))]),l[5]||(l[5]=m("div",{class:"empty"},null,-1))]))}},ie=N(ae,[["__scopeId","data-v-bd804c11"]]),re={class:"info"},ue={key:0,class:"name"},ce={key:1,calss:"name"},de={__name:"UserInfo",props:{name:String,isBlack:Boolean,record:String,isActive:Boolean},setup(i){return(h,l)=>{var n;return y(),p("div",{class:$(["user-info stone",{active:i.isActive,black:i.isBlack,white:!i.isBlack}])},[m("div",re,[(n=i.name)!=null&&n.trim()?(y(),p("p",ue,"ÎãâÎÑ§ÏûÑ : "+_(i.name),1)):(y(),p("p",ce,"ÏÉÅÎåÄÍ∞Ä ÏóÜÏäµÎãàÎã§"))])],2)}}},F=N(de,[["__scopeId","data-v-83f3d876"]]),k=15,E=[[1,0],[0,1],[1,1],[1,-1]],M=i=>[i%k,Math.floor(i/k)];function fe(i){return i==null?null:i%2===1?"black":"white"}function me(i,h){const[l,n]=M(h),r={hasOverline:!1,hasFive:!1};for(const[o,e]of E){let t=1;for(const s of[-1,1]){let d=l+o*s,u=n+e*s;for(;d>=0&&d<k&&u>=0&&u<k&&fe(i[u*k+d])==="black";)t++,d+=o*s,u+=e*s}t>=6?r.hasOverline=!0:t==5&&(r.hasFive=!0)}return r}function ye(i,h){let l=0;const[n,r]=M(h),o=(e,t)=>e<0||e>=k||t<0||t>=k?"OUT":i[t*k+e];for(const[e,t]of E){for(const s of[-1,1]){let d=o(n+s*e,r+s*t),u=o(n+2*s*e,r+2*s*t),f=o(n+3*s*e,r+3*s*t),v=o(n+4*s*e,r+4*s*t);(d%2===1&&u%2===1&&f%2===1||d%2===1&&u===null&&f%2===1&&v%2===1||d%2===1&&u%2===1&&f===null&&v%2===1||d===null&&u%2===1&&f%2===1&&v%2===1)&&l++}for(const s of[-1,1]){let d=o(n-s*e,r-s*t),u=o(n+s*e,r+s*t),f=o(n+2*s*e,r+2*s*t),v=o(n+3*s*e,r+3*s*t);(d%2===1&&u%2===1&&f%2===1||d%2===1&&u===null&&f%2===1&&v%2===1||d%2===1&&u%2===1&&f===null&&v%2===1)&&l++}for(const s of[-1,1]){let d=o(n-2*s*e,r-2*s*t),u=o(n-s*e,r-s*t),f=o(n+s*e,r+s*t),v=o(n+2*s*e,r+2*s*t);d%2===1&&u%2===1&&f===null&&v%2===1&&l++}}return l}function ve(i,h){const[l,n]=M(h);let r=0;const o=(e,t)=>e<0||e>=k||t<0||t>=k?"OUT":i[t*k+e];for(const[e,t]of E){let s=o(l-2*e,n-2*t),d=o(l-e,n-t),u=o(l+e,n+t),f=o(l+2*e,n+2*t),v;s===null&&d%2===1&&u%2===1&&f==null&&r++;for(const c of[-1,1])s=o(l-c*e,n-c*t),d=o(l+c*e,n+c*t),u=o(l+2*c*e,n+2*c*t),f=o(l+3*c*e,n+3*c*t),s===null&&f===null&&d%2===1&&u%2===1&&r++;for(const c of[-1,1])s=o(l-c*e,n-c*t),d=o(l+c*e,n+c*t),u=o(l+2*c*e,n+2*c*t),f=o(l+3*c*e,n+3*c*t),v=o(l+4*c*e,n+4*c*t),s===null&&v===null&&(d%2===1&&u===null&&f%2===1&&r++,d===null&&u%2===1&&f%2===1&&r++);for(const c of[-1,1])s=o(l-2*c*e,n-2*c*t),d=o(l-c*e,n-c*t),u=o(l+c*e,n+c*t),f=o(l+2*c*e,n+2*c*t),v=o(l+3*c*e,n+3*c*t),s===null&&v===null&&d%2===1&&u===null&&f%2===1&&r++}return r}function pe(i,h){const{hasOverline:l,hasFive:n}=me(i,h),r=ve(i,h),o=ye(i,h);return console.log(r),(l||r>=2||o>=2)&&!n}const he={class:"timer"},ke={__name:"TimerComp",props:{initialTime:Number},emits:["timeout"],setup(i,{expose:h,emit:l}){const n=i,r=l,o=x(n.initialTime);let e=null;function t(){e=setInterval(()=>{o.value>0&&(o.value--,o.value===0&&(r("timeout"),s()))},1e3)}function s(){clearInterval(e),e=null}function d(){s()}function u(){!e&&o.value>0&&t()}return R(t),L(s),H(()=>n.initialTime,()=>{t()}),h({pause:d,resume:u}),(f,v)=>(y(),p("div",he,[m("p",null,"Ï∞©Ïàò Ï†úÌïú: "+_(o.value)+"Ï¥à",1)]))}},be=N(ke,[["__scopeId","data-v-41a649f6"]]),_e={class:"game-header"},Be={class:"header-left flex col-center"},Te={key:0},ge={class:"header-mid flex dir-col row-center col-center"},Ie={key:1,class:"victory"},Ce={key:2,class:"turn"},xe={class:"game-board"},Pe={class:"flex dir-col center"},Ae={class:"margin-center"},$e={class:"board-con flex row-center col-center"},Ne={class:"flex dir-col row-end"},Oe=["disabled"],I=15,Se={__name:"BoardPage",setup(i){const h=ee(),l=j(),n=w({id:l.playerId,name:l.username,ready:!1}),r=W(),{show:o}=X();x(null);const e=w({title:"",roomId:"",turn:1,board:Array(I*I).fill(null),isPlaying:!1}),t=w({id:null,name:null,ready:!1}),s=x(null),d=x([]),u=x(null),f=Y(()=>{const a=e.turn%2===1;return u.value===a});function v(a){var b;if(!(!e.isPlaying||!f.value)){if(e.turn%2==1&&pe(e.board,a)){o("Ìï¥Îãπ ÏúÑÏπòÎäî Í∏àÏàòÏûÖÎãàÎã§","error",2e3);return}(b=T.stompClient)==null||b.publish({destination:"/app/move",body:JSON.stringify({type:"ACTION",sender:n,roomId:e.roomId??C.params.roomNo,index:a})})}}function c(){var a;(a=T.stompClient)==null||a.publish({destination:"/app/ready",body:JSON.stringify({type:"READY",sender:n,roomId:e.roomId??C.params.roomNo})})}function U(){var a;!e.isPlaying||!f.value||(a=T.stompClient)==null||a.publish({destination:"/app/timeout",body:JSON.stringify({type:"TIMEOUT",sender:n,roomId:e.roomId??C.params.roomNo})})}const C=Z(),O=C.params.roomNo;console.log("room id = ",O);const T=q();async function V(){try{await G.post(`${r.BASEURL}/api/rooms/leave/${C.params.roomNo}`,null,{params:{playerId:n.id}}),T.disconnect()}catch(a){console.error("Î∞© ÎÇòÍ∞ÄÍ∏∞ Ïò§Î•ò Î∞úÏÉù:",a)}finally{h.push({name:"Home"})}}async function D(){const{data:a}=await G.get(`${r.BASEURL}/api/rooms/${O}`);console.log(a),e.title=a.title,e.roomId=a.roomId,e.turn=a.turn,e.board.splice(0,e.board.length,...a.board.flat().map(g=>g===0?null:g)),e.isPlaying=a.isPlaying;const b=a.players.find(g=>g.id!==n.id);b!=null&&(t.id=b.id,t.name=b.name)}D();function J(a){if(a.type==="JOIN"){if(console.log("join"),a.message===n.name)return;console.log(`üì¢ Ïú†Ï†Ä ÏûÖÏû• ÏïåÎ¶º: ${a.message}`),t.name=a.message,t.id=a.sender,o(`${a.message}ÎãòÏù¥ ÏûÖÏû•ÌïòÏÖ®ÏäµÎãàÎã§`)}else if(a.type==="GAME_START")console.log("üéÆ Í≤åÏûÑ ÏãúÏûë Î©îÏãúÏßÄ ÏàòÏã†Îê®!"),e.isPlaying=!0,e.turn=1,e.board=Array(I*I).fill(null),n.ready=!1,t.ready=!1,s.value=null,d.value=[],u.value=a.blackPlayer===n.id,console.log("my stone is black:",u.value),o("Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.","info",2e3);else if(a.type==="ACTION")e.board[a.index]=e.turn,e.turn=a.turn,s.value=a.index,d.value.push(s.value);else if(a.type==="GAME_END")e.board[a.index]=e.turn,e.turn=a.turn,a.index!=null&&(s.value=a.index),d.value.push(s.value),e.isPlaying=!1,o(a.message,"info");else if(a.type==="LEAVE")e.board=Array(I*I).fill(null),o(`${t.name} ÎãòÏù¥ Î∞©ÏùÑ ÎÇòÍ∞îÏäµÎãàÎã§`),t.id=null,t.name=null,t.ready=!1,n.ready=!1;else if(a.type==="READY"){if(a.message===n.name){n.ready=!0;return}t.ready=!0,o(a.message+"Îãò Ï§ÄÎπÑ ÏôÑÎ£å")}}return R(()=>{T.setHandler(J),T.connect(O,n)}),(a,b)=>{const g=K("font-awesome-icon");return y(),p(A,null,[m("div",_e,[m("div",Be,[e.isPlaying?B("",!0):(y(),p("div",Te,[m("button",{class:"btn out-btn",onClick:V},[P(g,{icon:["fas","arrow-left"]}),b[0]||(b[0]=z("ÎÇòÍ∞ÄÍ∏∞ "))])]))]),m("div",ge,[e.isPlaying?(y(),Q(be,{initialTime:10,key:e.turn,onTimeout:U})):B("",!0),e.isPlaying?B("",!0):(y(),p("div",Ie,_(e.board[s.value]%2==1?"ÌùëÎèå":"Î∞±Îèå")+" ÏäπÎ¶¨ ",1)),e.isPlaying?(y(),p("div",Ce,"Ï†ú "+_(e.turn)+" Ïàò",1)):B("",!0)])]),m("div",xe,[m("div",Pe,[P(F,{class:"opponent",name:t.name,isBlack:!u.value,isActive:!f.value&&e.isPlaying||t.ready&&!e.isPlaying},null,8,["name","isBlack","isActive"]),m("div",Ae,_(t.ready?"Ï§ÄÎπÑ ÏôÑÎ£å":""),1)]),m("div",$e,[P(ie,{isBlackTurn:e.turn%2==1,isMyTurn:f.value,flatBoard:e.board,lastIndex:e.isPlaying?s.value:null,onCellClick:v,isGameOver:!e.isPlaying},null,8,["isBlackTurn","isMyTurn","flatBoard","lastIndex","isGameOver"])]),m("div",Ne,[!e.isPlaying&&t.id!=null?(y(),p("button",{key:0,class:"btn",onClick:c,disabled:n.ready}," Ï§ÄÎπÑ ",8,Oe)):B("",!0),P(F,{class:"me",name:n.name,isBlack:u.value,isActive:f.value&&e.isPlaying||n.ready&&!e.isPlaying},null,8,["name","isBlack","isActive"])])])],64)}}},Me=N(Se,[["__scopeId","data-v-ad77bc01"]]);export{Me as default};
